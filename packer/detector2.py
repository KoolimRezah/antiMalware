#!/usr/bin/python
 
# simple packer detection script using the PEiD database
 
import peutils
import pefile
import argparse
import sys
import os
curPath = os.path.dirname(os.path.abspath(__file__))
# Adjust this accordingly
USERDB = curPath+"\UserDB.txt"
 
 
def packdetect(arg_pe):
    """attempt to detect the packer in use"""
    pe = pefile.PE(arg_pe)
    signatures = peutils.SignatureDatabase(USERDB)
    with file(USERDB, 'rt') as f:
        sig_data = f.read()
    signatures = peutils.SignatureDatabase(data = sig_data)
    matches = signatures.match_all(pe, ep_only = True)    
    return "Possible packers:" + str(matches)
 
 
def main(pefile):
 
    # menu system
    
    arg_pe = pefile
    print "analysing..."
    return packdetect(arg_pe)
 
 
if __name__ == '__main__':
    main()
